# 编译器设计文档



## 词法分析

### Pre. 添加整型编码和分支归属

Sys语言的词法分析类别码定义如下(增加整型编码)：

<div>
  <table style="border-collapse:collapse;" width="100%">
 <tbody>
  <tr height="15.75px">
   <td valign="center" style="font-weight:700;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">单词名称</td>
   <td valign="center" style="font-weight:700;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">类别码</td>
   <td valign="center" style="font-weight:700;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">编码</td>
   <td valign="center" style="font-weight:700;font-size: 11px;width:2908px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">所属分析层</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">Ident</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">IDENFR</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">0</td>
   <td rowspan="13" colspan="1" valign="center" style="font-weight:400;font-size: 11px;width:2908px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">words</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">main</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">MAINTK</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">1</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">const</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">CONSTTK</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">2</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">int</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">INTTK</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">3</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">break</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">BREAKTK</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">4</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">continue</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">CONTINUETK</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">5</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">if</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">IFTK</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">6</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">else</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">ELSETK</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">7</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">while</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">WHILETK</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">8</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">getint</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">GETINTTK</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">9</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">printf</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">PRINTFTK</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">10</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">return</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">RETURNTK</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">11</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">void</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">VOIDTK</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">12</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">!</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">NOT</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">13</td>
   <td rowspan="23" colspan="1" valign="center" style="font-weight:400;font-size: 11px;width:2908px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">op_div</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">&amp;&amp;</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">AND</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">14</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">||</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">OR</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">15</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">+</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">PLUS</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">16</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">-</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">MINU</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">17</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">*</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">MULT</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">18</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">/</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">DIV</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">19</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">%</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">MOD</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">20</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">&lt;</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">LSS</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">21</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">&lt;=</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">LEQ</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">22</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">&gt;</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">GRE</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">23</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">&gt;=</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">GEQ</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">24</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">==</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">EQL</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">25</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">!=</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">NEQ</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">26</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">=</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">ASSIGN</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">27</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">;</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">SEMICN</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">28</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">,</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">COMMA</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">29</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">(</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">LPARENT</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">30</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">)</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">RPARENT</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">31</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">[</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">LBRACK</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">32</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">]</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">RBRACK</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">33</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">{</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">LBRACE</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">34</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">}</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">RBRACE</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">35</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">IntConst</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">INTCON</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">36</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2908px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">digit</td>
  </tr>
  <tr height="15.0px">
   <td valign="center" style="font-weight:400;font-size: 11px;width:3871px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">FormatString</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:4302px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">STRCON</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2104px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">37</td>
   <td valign="center" style="font-weight:400;font-size: 11px;width:2908px;text-align:center;color:#000000;border-top:solid #d0d7e5 1px;border-right:solid #d0d7e5 1px;border-bottom:solid #d0d7e5 1px;border-left:solid #d0d7e5 1px;">string</td>
  </tr>
 </tbody>
</table>
</div>
`所在分析层` 定义为为通过所获得的第一个字符后所选择进入的主要分支结构，如若取得的第一个字符为`[a-zA-Z_]`则进入`words`分支

分析层除了表格中列出的四种之外，还存在一个`annotation` 表示对于注释的分析，以遇到`/`字符为标志。因此`/`字符较为特殊的归入此分析层。



### 程序设计

#### 公共变量和函数

* `programCode`程序总的字符串

* `character` 当前字符
* `token` 当前字符串builder
* `tokenClass` 保存当前识别单词的类型
* `num` 存放当前读入的整型数值
* `catToken()`将当前character字符与token连接
* `reserver()` 从保留字中查找，返回标识码或`-1`(表示没找到)
* `retract()` 将读取的字符指针向后回退一个字符



#### 类定义

词法分析将每次得到的最终结果定义如下的类

```java
public class Token {
    private final String tokenClass;  // TokenClass Symbol
    private final int codeVal;        // encode value 0-37
    private final String originStr;   // original string
    private final int intValue;       // value(only `INTCON` have)
    ...
}
```



#### 字符所属类别的函数定义

对于每个字符的所属类别定义如下布尔函数

不同的类别列表如下

| 函数名    | 所含字符 |
| --------- | -------- |
| isSpace   | \s       |
| isNewLine | \n       |
| isTab     | \t       |
| isLetter  | a-zA-z   |
| isDigit   | 0-9      |
| isSemi    | ;        |
| isComma   | ,        |
| isLBrace  | {        |
| isRBrace  | }        |
| isLBrack  | [        |
| isRBrack  | ]        |
| isLParent | (        |
| isRParent | )        |
| isEqs     | =        |
| isAdd     | +        |
| isMinus   | -        |
| isStar    | *        |
| isPercent | %        |
| isLABrace | <        |
| isLABrace | >        |
| isVLine   | \|       |
| isAnd     | &        |
| isExc     | !        |
| isDiv     | /        |

在判断时，对于除`*`以外的符号，若`index >= programCode.length` 则直接返回`false`

而`*`由于用作注释的判断，会出现`while`循环的条件为`!isStar()`，因此需要进行特殊设计，在每次判断前现行判断是否越界。



## 语法分析

> 与词法分析的衔接：实验编译器采用多遍扫描的方法。词法分析的结果是一个存储了所有token的`ArrayList`。语法分析获得词法分析的结果，通过index不断读取token进行分析。



### "递归下降 + 超前看 + 回溯" 的分析方法

> 首先消除左递归支持绝大部分分析可以通过递归下降的实现，对于首字符集相同的部分，绝大部分可以通过超前看一两个终结符解决，唯一出现一个地方需要通过回溯的方式提前分析。具体设计部分分述如下：



#### 1. 消除左递归

在分析本次的语法时，首先对左递归的文法进行改写：

乘除模表达式： `MulExp → UnaryExp | MulExp ('*' | '/' | '%') UnaryExp`改写为``MulExp → MulExp {('*' | '/' | '%') MulExp}`

加减表达式 `AddExp → MulExp | AddExp ('+' | '−') MulExp` 改写为 `AddExp → MulExp {('+' | '−') MulExp}`

关系表达式 `RelExp → AddExp | RelExp ('<' | '>' | '<=' | '>=') AddExp`改写为``RelExp → AddExp { ('<' | '>' | '<=' | '>=') AddExp}``

相等性表达式 `EqExp → RelExp | EqExp ('==' | '!=') RelExp`改写为`EqExp → RelExp {('==' | '!=') RelExp}`

逻辑或表达式 `LOrExp → LAndExp | LOrExp '||' LAndExp`改写为`LOrExp → LAndExp {'||' LAndExp}`

逻辑与表达式 `LAndExp → EqExp | LAndExp '&&' EqExp`改写为``LAndExp → EqExp {'&&' EqExp}`



#### 2. 超前看

对于首字符集相同的部分， 而仅仅需要超前一两个终结符即可判断的，采用超前看的方法。

在此列出所有可以通过超前看而不必回溯的递推式及条件：

1. `编译单元 CompUnit → {Decl} {FuncDef} MainFuncDef` 通过超前看一个终结符(token)是否为`MAINTK main`，及超前看两个终结符是否为`LPARENT (` 来区分变量申明、函数定义和主函数。
2. `⼀元表达式 UnaryExp → PrimaryExp | Ident '(' [FuncRParams] ')'` 通过超前看一个终结符是否为`LPARENT (` 来区分基本表达式和函数调用。



#### 3. 回溯

本实验文法仅有一处无法通过直接的超前看区分，即

```
语句 Stmt → LVal '=' Exp ';' | LVal = 'getint''('')'';'
```

这里的两种递推方法开始处均为`LVal`，故无法通过超前看解决问题，此问题同样可以通过改写语法规则实现，但本次设计中采用回溯的方法。简单算法如下：

> 1. 保存index。
> 2. 读取一个`LVal`，并读取一个 `=`。
> 3. 查看下一个非终结符是否为`GETINTTK getint`，从而决定递推方向。
> 4. 返回到已保存的index，沿着选定的方向递推。



### ASD语法树

递归下降的分析结果产生一颗语法树，语法树的节点类的类名完全和文法的非终结符相同。建立`ASDNode`接口，使得所有节点类实现此接口。要求所有节点中实现`遍历`、`输出符合语法测试要求debug信息`、`与符号表进行链接` 、`语法语义的错误检查`等函数

节点类的继承关系如图所示：

```mermaid
graph TD;
Decl-->ConstDecl;
Decl-->VarDecl;
Def-->ConstDef;
Def-->VarDef;
BlockItem-->Decl;
BlockItem-->Stmt;
Cond-->LOrExp;
Number-->IntConst;
Exp-->AddExp;
UnaryExp-->PrimaryExp;
MulExp-->UnaryExp;
AddExp-->MulExp;
RelExp-->AddExp;
EqExp-->AddExp;
LAndExp-->EqExp;
LOrExp-->LAndExp;
ConstExp-->AddExp
```

其他类均与文法的非终结符同名，不存在继承关系，具有扁平结构。



### 符号表

采用栈式符号表的方法，遵循一块一表(全局表除外)由`<当前块的层级，当前层级的第几块> `唯一标识一张符号表。在每次进入一个块时，新建一张表(若为函数块还需要添加所有的形式变量`FuncFormVar`，每次读到变量声明则同时向表和符号栈中添加一个`SymItem`，在退出该块时，从符号栈中删除将当前符号表中的所有项。

每个符号表本身存储一个`Arraylist`，其中存有实现了`SymItem`接口的类的实例, 共有三种类实现此接口：

* `var` 所有的`int`变量和`const`常量
* `Func`所有的函数定义
* `FuncFormVar` 所有的函数形参

```mermaid
graph TD;
SymItem --> Var
SymItem --> Func
SymItem --> FuncFormVar
```

### 符号表的链接

符号表的链接是一张总的`HashMap`，用于建立抽象语法树中`Indent`标识符与`SymItem`之间的映射关系。 具体的建立步骤如下：

首先创建一张全局符号表，建立个总的栈，此后对之前建立的语法树进行一次中序遍历，期间：

> 记录当前Block层级的标识符<当前层级数，是相同层级的第几块>，确定一张全局的表记录层级的数量
>
> 1. 若遍历到了 `Block` 项， 创建一个新的符号表，当前层级数+1， 层级数量+1，绑定该符号表与层级标识符。
>2. 遍历到了 `Decl`项，首先检查栈中是否存在同名变量，存在则直接报错，否则建立SymItem项存储在栈中和当前的符号表中
> 3. 遍历到了`LVal`项，依照从栈顶到栈底的顺序进行扫描，若找到同名变量则进行注册(在`HashMap`中创建键值对)，并在层级关系中进行绑定。
> 4. 遍历到了`UnaryExp`项且属于`FuncCall`类型，依照从栈顶到栈底的顺序进行扫描，若找到同名则检查函数类型是否匹配，并在HashMap中创建键值对， 在层级关系中进行绑定。
> 5. 便利到了`FuncDef`项，将`FuncFParam`转化为符号表的`SymItem`后标记存入到
> 6. 若遍历完`Block`的子树返回，则将栈中所有当前符号表的项弹出



### 错误处理

注：加入错误处理后直接在递归下降的过程中打印语法分析的结果会有问题。

对于错误类别码为a、i、j、k的错误，归入词法或语法错误的范畴，在语法分析和词法分析阶段报出。

对于其他类别码的错误，归入语义错误的范畴，在建立符号表链接的过程中报出。

由于此部分错误的发现和记录和正常的编译程序的过程分属两个不同的控制流，因此采用异常的方式进行记录。

此外，建立一个`Recorder`类，遇到新的报错即保存下来，留待语法分析和符号表链接结束后输出。

